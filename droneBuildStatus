{
  "name": "droneBuildStatus",
  "version": "0.0.6",
  "type": "sensor",
  "script": "// Drone api documentation:\n// http://readme.drone.io/0.5/api/overview/\n//\n// get your token from the account page\n\n\nvar props = options.requiredProperties\n\nif(props.baseUrl !== undefined && props.token !== undefined) {\n  var baseUrl = props.baseUrl\n  var token = props.token\n  var options = {\n    'url': `${baseUrl}/api/user/feed?latest=true&access_token=${token}`,\n  };\n\n  var callback = function(error, response, body) {\n    if (!error && response.statusCode == 200) {\n      var json = JSON.parse(body)\n      var success = json.filter(b => b.status === \"failure\").length === 0\n      const state = success ? 'OK' : 'NOK'\n      var value = {\n        observedState: state,\n        rawData : {\n          repos: json\n        }\n      };\n      send(null, value)\n    }else{\n      send(new Error(`${error} ${body}`))\n    }\n  }\n  request(options, callback)\n}else{\n  send(new Error('Missing properties'))\n}",
  "metadata": {
    "author": "Waylay",
    "category": "Experimental",
    "description": "Drone sensor\n<h3>Properties:</h3>\n<ul>\n<li>baseUrl (eg https://drone.yourcompany.com)</li>\n<li>token (get it from your account page)</li>\n</ul>",
    "iconURL": "https://static.waylay.io/plugs/icons/drone-build-status.png",
    "supportedStates": [
      "OK",
      "NOK"
    ],
    "requiredProperties": [
      "baseUrl",
      "token"
    ],
    "requiredRawData": [],
    "rawData": []
  }
}
