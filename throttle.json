{
  "name": "throttle",
  "version": "2.0.0",
  "type": "sensor",
  "script": "/*\n * invocationPolicy as a sensor, effectively throttling the next nodes\n */\nconst parse = require('parse-duration')\n\nconst internalState = options.internalState || {}\n\nconst { lastInvocation = Date.now() } = internalState\nconst { duration } = options.requiredProperties\n\nasync function execute () {\n  if (!duration) {\n    throw new Error('Missing property')\n  }\n  // parse the human duration to milliseconds\n  const durationMs = parse(duration)\n  // we should trigger if the lastInvocation was older than the duration\n  const diff = Date.now() - lastInvocation\n  const shouldTrigger = diff > durationMs\n\n  // make sure we update the lastInvocation time\n  if (shouldTrigger) {\n    const lastInvocation = Date.now()\n\n    return send(null, {\n      internalState: { lastInvocation },\n      rawData: { lastInvocation },\n      observedState: 'Trigger'\n    })\n  }\n\n  return send(null, {\n    internalState: { lastInvocation },\n    rawData: { lastInvocation },\n    observedState: 'No Trigger'\n  })\n}\n\nexecute().catch(send)\n",
  "metadata": {
    "author": "Gilles De Mey",
    "description": "<h4>Throttle</h4>\n<br>\nThrottle next invocation of a node\n<br><br>\n<b>States</b>\n<ul>\n    <li>\n       Trigger\n    </li>\n    <li>\n       No Trigger\n    </li>\n</ul>\n<b>Raw Data</b>\n<ul>\n    <li>\n        lastInvocation: Timestamp of last invocation\n    </li>\n</ul>\n<br>\n<b>Properties</b>\n<ul>\n    <li>\n        duration: How long to wait until next invocation (specified as a human readable string e.g.: \n            ‘1d’ => 1 day \n            ‘1hr 20mins’ => 1 * h + 20 * m )       \n    </li>\n</ul>\n",
    "iconURL": "https://static.waylay.io/plugs/icons/throttle.png",
    "supportedStates": [
      "Trigger",
      "No Trigger"
    ],
    "requiredProperties": [
      "duration"
    ],
    "requiredRawData": [],
    "rawData": [
      {
        "parameter": "lastInvocation",
        "dataType": "number"
      }
    ],
    "configuration": [
      {
        "name": "duration",
        "type": "string",
        "mandatory": true,
        "format": {},
        "defaultValue": ""
      }
    ]
  },
  "dependencies": {
    "parse-duration": "^0.4.0"
  }
}