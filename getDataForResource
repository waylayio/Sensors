{
  "name": "getDataForResource",
  "version": "1.0.1",
  "type": "sensor",
  "script": "const resource = waylayUtil.getProperty(options, 'resource') || waylayUtil.getResource(options)\nconst streamData = waylayUtil.getStreamData(options) || {}\nconst from = waylayUtil.getProperty(options, 'from')\n\nasync function main () {\n    if (!resource) {\n        throw new Error('Resource required either from task or property')\n    }\n\n    const res = await  waylay.data.getSeries(resource, { metadata: true })\n        .catch(() => send(null, { observedState: \"Not Collected\" }))\n    \n    const fromMillis = from.toString().startsWith('P')\n        ? moment() - moment.duration(from)\n        : from\n\n    const timeseriesData = _.reduce(res, (acc, metric) => {\n        if(!fromMillis || new Date(fromMillis) <= new Date(metric.latest.timestamp)) {\n            acc[metric.name] = metric.latest.value\n        }\n        \n        return acc\n    }, {})\n\n    const data = _.merge(timeseriesData, streamData)\n    \n    send(null, { observedState: \"Collected\", rawData: { data } })\n}\n\nmain().catch(send)\n",
  "metadata": {
    "author": "Ward",
    "category": "Timeseries",
    "description": "Returns a json object with all metrics that have been received on [resource].\n\n<b>Params</b>\n\n<ul>\n <li>Resource (Defaults to task resource)</li>\n <li>From: Only show data that arrived since. (Optional), supports milliseconds or relative PT time</li>\n</ul>",
    "iconURL": "https://static.waylay.io/plugs/icons/graph-circle.png",
    "supportedStates": [
      "Collected",
      "Not Collected"
    ],
    "requiredProperties": [
      "resource",
      "from"
    ],
    "requiredRawData": [],
    "rawData": [
      {
        "parameter": "data",
        "dataType": "double"
      }
    ]
  }
}
