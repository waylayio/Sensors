{
  "name": "getAlarmsByFilter",
  "version": "1.0.6",
  "type": "sensor",
  "script": "const resource = options.node.RESOURCE\nconst statusFilter = options.requiredProperties.status\nconst history = options.requiredProperties.history\nconst typeFilter = options.requiredProperties.type\n\nconst alarmFilter = {\n  source: resource,\n  ...(history && { history: history }),\n  ...(typeFilter && { type: typeFilter }),\n  ...(statusFilter && { status: statusFilter }),\n  all: true\n}\n\nif (resource === undefined || resource === '') {\n  send(new Error('resource not defined'))\n}\n\nwaylay.alarms.search(alarmFilter)\n  .then(response => {\n    if (response.total > 0) {\n      send(null, { observedState: 'Found', rawData: { total: response.total, alarms: response.alarms } })\n    }\n    send(null, { observedState: 'Not Found', rawData: { total: response.total } })\n  })\n  .catch(err => {\n    send(new Error('Querying alarms failed: ' + err))\n  })\n",
  "metadata": {
    "author": "",
    "description": "<h4>getAlarmsByFilter Sensor</h4>\n<br>\nFetches all alarms on resource based on a filter.\n<br><br>\n<b>States</b>\n<br>\n<ul>\n    <li>\n        Found\n    </li>\n    <li>\n        Not Found\n    </li>\n</ul>\n<br>\n<b>Raw data</b>\n<ul>\n    <li>\n        total : total number of alarms\n    </li>\n    <li>\n        alarms: array of found alarms\n    </li>\n</ul>\n<br>\n<b>Properties</b>\n<ul>\n    <li>\n        status: the status of the alarms. (ACTIVE,CLEARED or ACKNOWLEDGED) If left empty, only ACTIVE alarms will be fetched\n    </li>\n    <li>\n        type: the type of the alarms\n    </li>\n    <li>\n        history (boolean): if the history of the alarms should be fetched or not\n    </li>\n\n</ul>\n",
    "iconURL": "https://static.waylay.io/plugs/icons/get-alarm-by-filter.png",
    "supportedStates": [
      "Found",
      "Not Found"
    ],
    "requiredProperties": [
      "status",
      "history",
      "type"
    ],
    "requiredRawData": [],
    "rawData": [
      {
        "parameter": "total",
        "dataType": "double"
      },
      {
        "parameter": "alarms",
        "dataType": "object"
      }
    ]
  }
}